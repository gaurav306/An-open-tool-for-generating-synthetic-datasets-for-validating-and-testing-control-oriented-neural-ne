
# *synconn_build* : An open tool for generating *syn*thetic datasets for validating and testing *c*ontrol-*o*riented *n*eural *n*etworks for *build*ing dynamics prediction

## Introduction
![alt text](https://github.com/gaurav306/NatureSD_paper_temporary/blob/master/README_utils/new_wf1.jpg)
Applying model-based predictive control in buildings requires a control-oriented model capable of learning how various control actions influence building dynamics, such as indoor air temperature and energy use. However, there is currently a shortage of empirical or synthetic datasets with the appropriate features, variability, quality and volume to properly benchmark these control-oriented models. Addressing this need, a flexible, open-source, Python-based tool, synconn_build, capable of generating synthetic building operation data using EnergyPlus as the main building energy simulation engine is introduced. The uniqueness of synconn_build lies in its capability to automate multiple aspects of the simulation process, guided by user inputs drawn from a text-based configuration file. It generates various kinds of unique random signals for control inputs, performs co-simulation to create unique occupancy schedules, and acquires weather data. Additionally, it simplifies the typically tedious and complex task of configuring EnergyPlus files with all user inputs. Unlike other synthetic datasets for building operations, synconn_build offers a user-friendly generator that selectively creates data based on user inputs, preventing overwhelming data overproduction.

## High-level workflow
The codebase for the data generator comprises three main folders: *‘Dataset_output/’*, *‘Offline_weather_file_input/’*, and *‘src/*’. The *‘Dataset_output/’* folder contains the final time series data generated, which is further described in the 'Data availability' section. The ‘src/’ folder is dedicated to all the scripts and auxiliary files required by the data generator. As discussed before this tool enables the user to create customized datasets for a variety of settings. These options are summarized in the ‘Config_input.yaml’ configuration file, in which users can modify various variables according to the instructions provided in the comments. This configuration file is critical to the tool's functionality, as all the scripts depend on its inputs. 
The *‘Run_main.py’* script triggers the data creation pipeline, depicted in Figure below, which provides a high-level overview of the tool's workflow. This script transforms the text data from ‘Config_input.yaml’ into a dictionary that serves as the settings for the entire pipeline. The main script calls *‘src/OB_GEN/OB_generator.py’* to generate stochastic occupancy schedules depending on user settings. It then calls ‘src/Signal_generator.py’ to generate different random signals used as schedules in EnergyPlus simulation. Finally, it calls *‘src/EP_Generator.py’*, which handles the complex task of manipulating and editing the EnergyPlus input data file (IDF). It also downloads weather files, creates the necessary directories, and finally initiates the EnergyPlus program to perform the final simulations. The components of this pipeline will be discussed in greater detail in the subsequent sub-sections.

![High-level workflow of the data generator](https://github.com/gaurav306/NatureSD_paper_temporary/blob/master/README_utils/new_wf2.jpg "High-level workflow of the data generator")

## File structure of the codebase
![File structure of the codebase for data generator](https://github.com/gaurav306/NatureSD_paper_temporary/blob/master/README_utils/new_filestruc.jpg "File structure of the codebase for data generator")
## Output dataset structure
Time-series data. The time-series dataset generated by the EnergyPlus simulation engine is provided in CSV file format. The first column is labelled *"Data/Time"*, representing the date and time of each record, while the remaining columns correspond to different variables and measurements related to building dynamics. The dataset covers a full year of simulation, with 15-minute time steps, resulting in a file size ranging from 25 MBs to 27 MBs. All variables in the dataset are reported in SI units, with the exception of a few dimensionless variables (see Table 1). The generated time series dataset can be conveniently analysed using any comma-delimited viewer software or programming tools.

The file structure of the dataset. The dataset generator produces a structured set of output files, input files, and weather data to ensure that simulations are repeatable and that all CSV dataset files are easily accessible through basic scripts. Figure above illustrates the file structure and naming conventions used in the *‘Dataset_output/’* folder. The folder structure includes a unique identifier *(%city_name%)* based on the name of the weather files used by the user, a user-chosen prefix identifier *(%prefix_identifier%)* to categorize different simulation runs, and an identifier for simulation timestep intervals chosen by the user *(%interval%)*. For instance, if a simulation is conducted with an interval of 15 minutes, HVAC mode as 1 and with no random window openings, the %prefix_identifier% could be *'HVAC-1_Windows-0'* and *%interval%* would be 15. The folder structure also includes a simulation index *(%n%)* for the user-chosen setting *‘number_of_stochastic_EP_cases_to_generate'*, where *%n%* represents the index number for the same type of simulation run with the same %prefix_identifier%. 
It is important to note that all the simulations in the folder with varying *%n%* will have the different randomness, including input signals for HVAC mode, HVAC setpoints and window opening signals and stochastic occupancy for the five zones. Whereas all the simulations in the folder with varying *%prefix_identifier%* will have different simulations settings like simulation timestep and enable/disable use of random HVAC mode/HVAC setpoints/window opening signals. The final time-series dataset output from EnergyPlus is *%City_name%_%n%_output.csv*. The simulation can be re-run again from the *'temp'* folder where all the required input files for EnergyPlus are copied.

![Final Time-series dataset file summary](https://github.com/gaurav306/NatureSD_paper_temporary/blob/master/README_utils/data_headers.jpg "Final Time-series dataset file summary")

# Instructions
## Step 1: EnergyPlus initialization

*Synconn_build* uses EnergyPlusv22.1.0 as the main simualtion engine. It can be downloaded from (https://github.com/NREL/EnergyPlus/releases/tag/v22.1.0).

After installation the user is required to fill in correct information in [Config_input.yaml](https://github.com/gaurav306/synconn_build/blob/main/Config_input.yaml#L1) file.
```yaml
energyplus_init:
  ep_dir: E:\EnergyPlusV22-1-0\
  idd_dir: E:\EnergyPlusV22-1-0\Energy+.idd
  timestep: 4
```
* **ep_dir**: Specify the path to your EnergyPlus directory.
* **idd_dir**: Specify the path to your EnergyPlus IDD file.
* **timestep**: Define the time-step size for the simulation. The unit is hours, with options ranging from 1 (for 1 hour) to 6 (for 10 minutes).

## Step 2: Weather files configuration

The user can run this tool both with or wthout internet connection. If there is internet connection the user can procure weather files from [climate.onebuilding.org](https://climate.onebuilding.org)

Settings for weather files configuration in [Config_input.yaml](https://github.com/gaurav306/synconn_build/blob/main/Config_input.yaml#L8) are as follows:

```yaml
weather_files: 
  get_epw: online
  epw_urls:
  - https://climate.onebuilding.org/WMO_Region_6_Europe/NOR_Norway/AK_Akershus/NOR_AK_Oslo.AP-Gardermoen.013840_TMYx.zip
  - https://climate.onebuilding.org/WMO_Region_6_Europe/NOR_Norway/TR_Troms/NOR_TR_Trondheim.AP-Vaernes.012710_TMYx.zip
  offline_weather_dir: 'Offline_weather_files_input'
  epw_ddy_names:         
  - Trondheim
  - Rome
```
* **get_epw**: Specify whether the weather files should be retrieved online or offline. Your options are 'online' or 'offline'.
* **epw_urls**: If `get_epw` is set to `online`, list the URLs of your preferred EPW files here. The program will download these files and create corresponding directories based on the URLs. To access a wide variety of weather files, you can visit [climate.onebuilding.org](https://climate.onebuilding.org).
* **offline_weather_dir**: If get_epw is `offline`, specify the directory that holds your offline weather files.
* **epw_ddy_names**: If get_epw is `offline`, provide the names of the EPW and corresponding DDY files here. The program will search for these files in the `offline_weather_dir` and run simulations based on them. Remember that the EPW and DDY files should have identical names, as the directory name will be based on these file names. Ensure the names of the EPW and its corresponding DDY file are identical. For instance, specifying 'Trondheim' implies that 'Trondheim.epw' and 'Trondheim.ddy' files are available in the offline_weather_dir directory.

## Step 3: Simulation details
For next step the user is required to make ceratin decisions and provide information.
Settings for Step 3 in [Config_input.yaml](https://github.com/gaurav306/synconn_build/blob/main/Config_input.yaml#L29) are as follows:

```yaml
ep_simualtion_data_details:
  ep_template_file: 'src/0_5-ZONE_VRF_BASEBORD_template.idf'
  run_ep_or_justmakeidf: 1
  number_of_stochastic_EP_cases_to_generate: 1
  unique_prefix_for_each_stochastic_case: 'sample'
  running_mode: full 
  random_holidays: True
  random_occupancy: True
  random_HVAC_mode: True
  random_window_opening: True
```
* **ep_template_file**: Specify the EnergyPlus template IDF file to be used for the simulation.
* **run_ep_or_justmakeidf**: Specify whether to run the EnergyPlus simulations (`1`) or just create the IDF files (`0`).
* **number_of_stochastic_EP_cases_to_generate**: Define the number of stochastic EnergyPlus cases you want to generate.
* **unique_prefix_for_each_stochastic_case**: This can be any string and is used to distinguish between different stochastic cases.
* **running_mode**: Choose the simulation duration. If set to `debug`, the simulation runs from October 1st to December 31st. If set to `full`, the simulation runs for the full year.
* **random_holidays**: If set to `True`, holidays are randomly selected from the list in `src/random_holidays_EPobjects_list.csv`. If `False`, no holidays are considered in the simulation, and weekends are not considered as holidays.
* **random_occupancy**: If set to `True`, occupancy is randomly generated using the OB_GENERATOR. If set to `False`, occupancy is fixed to EP schedule `OCCUPY-1`.
* **random_HVAC_mode**: If set to `True`, the HVAC mode is randomly selected from the list `[0,1,2,3]`, which corresponds to `[Off, Heat, Cool, Dual]`. If set to `False`, the HVAC mode is set to `3` (Dual).
* **random_window_opening**: If set to `True`, the window-opening schedule is determined by the signal generated. If set to `False`, the windows are always closed.
